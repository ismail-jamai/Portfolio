"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8070],{32559:function(e,t,n){n.d(t,{GO:function(){return C},Gm:function(){return b},Kn:function(){return q},L8:function(){return S},O3:function(){return p},Qs:function(){return T},RN:function(){return _},Yc:function(){return U},bQ:function(){return m},cd:function(){return r},dY:function(){return w},iR:function(){return K},nL:function(){return i},u0:function(){return Q}});var u,r,i,a=n(96933),o=n(5362),l=n(27218),s=n(30947),c=n(13262),d=n(77930),v=n(21520),f=n.n(v),y=n(7653),g=n(74119);(r||(r={})).Student="student",(u=i||(i={})).Study="study",u.Career="career",u.Research="research";let p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{defer:t}=e,{activeOrganization:n}=(0,l.t)(),u=(0,g.U)(),r=null==n?void 0:n.uuid;return(0,o.WE)("/api/organizations/".concat(r,"/projects?include_harmony_projects=true"),{queryKey:[c.gi,{orgUuid:r}],enabled:!!(n&&u&&!t),staleTime:0,select:e=>e.filter(e=>!e.archived_at)})},_=()=>{let{activeOrganization:e}=(0,l.t)(),t=(0,o.OJ)();return(0,y.useCallback)(async()=>(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/projects"))).json(),[null==e?void 0:e.uuid,t])},m=()=>{let{data:e,isLoading:t}=p();return{data:null==e?void 0:e.filter(e=>e.is_starred),isLoading:t}},h=(e,t)=>{let n=e.map(e=>({...e,lastConversation:null==t?void 0:t.find(t=>t.project_uuid===e.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),u=null==e?void 0:e.filter(e=>!n.find(t=>t.uuid===e.uuid));return[...n,...u]},C=()=>{let e=_(),t=(0,a.Pe)();return(0,y.useCallback)(async()=>{let[n,u]=await Promise.all([e(),t({limit:void 0})]);return h(n,u)},[t,e])},Q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{defer:t}=e,n=(0,g.U)(),{data:u,isLoading:r}=(0,a.QR)({limit:void 0,defer:!n||t}),{data:i,isLoading:o}=p({defer:t});return(0,y.useMemo)(()=>r||o?{data:i,isLoading:!0}:i&&u?{data:h(i,u),isLoading:!1}:{data:i,isLoading:!1},[i,u,r,o])},U=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid;return(0,o.WE)("/api/organizations/".concat(n,"/projects/").concat(e),{queryKey:[c.$T,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e),staleTime:0,meta:{noToast:e=>e instanceof s.Hx&&404===e.statusCode}})},T=()=>{let{activeOrganization:e}=(0,l.t)(),t=null==e?void 0:e.uuid,n=(0,d.useQueryClient)();return(0,o.uC)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[c.gi,{orgUuid:t}]}),n.invalidateQueries({queryKey:[c.n$,{orgUuid:t}]})}})},w=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid,u=b();return(0,o.Ne)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{u(e)},queryKey:[c.$T,{orgUuid:n,projectUuid:e}]})},S=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid,u=b();return(0,o.uC)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"DELETE",{onSuccess:()=>{u(e)}})},K=e=>{let{activeOrganization:t}=(0,l.t)(),n=null==t?void 0:t.uuid;return(0,o.WE)("/api/organizations/".concat(n,"/projects/").concat(e,"/conversations"),{queryKey:[c.lx,{orgUuid:n,projectUuid:e}],enabled:!!t,staleTime:0,select:e=>f()(e,e=>new Date(e.updated_at)).reverse()})},q=()=>{var e,t;let n=p(),u=null===(t=n.data)||void 0===t?void 0:null===(e=t.find(e=>e.is_starter_project))||void 0===e?void 0:e.uuid;return{...n,data:u}},b=()=>{let{activeOrganization:e}=(0,l.t)(),t=null==e?void 0:e.uuid,n=(0,d.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[c.$T,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[c.gi,{orgUuid:t}]}),n.invalidateQueries({queryKey:[c.n$,{orgUuid:t}]}),n.invalidateQueries({queryKey:[c.lx,{orgUuid:t,projectUuid:e}]})}}},74119:function(e,t,n){n.d(t,{H:function(){return a},U:function(){return i}});var u=n(27218),r=n(15992);let i=()=>{let e=(0,u.ZJ)(),t=(0,u.Cf)();return(0,r.useConfig)("claude_ai_projects_limits").config.get("max_free_projects",0)>0||t||e},a=()=>{let e=(0,u.ZJ)(),t=(0,u.Cf)(),n=(0,r.useConfig)("claude_ai_projects_limits");return e||t?void 0:n?n.config.get("max_free_projects",0):0}},96933:function(e,t,n){n.d(t,{$H:function(){return w},$Y:function(){return S},Bk:function(){return N},CJ:function(){return j},Cy:function(){return P},Gk:function(){return G},Ke:function(){return E},Ls:function(){return B},OD:function(){return I},PD:function(){return z},Pe:function(){return U},QR:function(){return Q},Rq:function(){return h},W:function(){return k},_C:function(){return T},cE:function(){return C},cj:function(){return H},f7:function(){return q},fc:function(){return L},gK:function(){return M},gm:function(){return b},j1:function(){return K},j7:function(){return O},jl:function(){return R},y6:function(){return D}});var u=n(19170),r=n(3053),i=n(5362),a=n(27218),o=n(1812),l=n(98731),s=n(13262),c=n(25551),d=n(51432),v=n(77930),f=n(50803),y=n(87590),g=n.n(y),p=n(81695),_=n(7653),m=n(1146);let h=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,a.t)(),u=null==n?void 0:n.uuid,[r,i]=(0,_.useReducer)(e=>e+1,0),o=(0,c.B)([s.I8,{orgUUID:u},{uuid:e}]),l=(0,_.useMemo)(()=>t.getQueryData(o),[t,o,e,r]);return(0,_.useEffect)(()=>t.getQueryCache().subscribe(e=>{"updated"===e.type&&"success"===e.action.type&&(0,f._x)({queryKey:o},e.query)&&i()}),[t,i,o]),{data:l}},C=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,a.t)(),u=null==n?void 0:n.uuid,r=(0,c.B)([s.I8,{orgUUID:u},{uuid:e}]);return t.getQueryData(r)},Q=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,u=new URLSearchParams,{limit:r,offset:o,defer:l}=e;void 0!==r&&u.append("limit",r.toString()),void 0!==o&&u.append("offset",o.toString());let c=u.toString();return c=c?"?".concat(c):"",(0,i.WE)("/api/organizations/".concat(null!=n?n:"","/chat_conversations").concat(c),{queryKey:[s.tv,{orgUUID:n},{limit:r,offset:o}],staleTime:3e5,enabled:!l&&!!n})},U=()=>{let{activeOrganization:e}=(0,a.t)(),t=(0,i.OJ)();return(0,_.useCallback)(async n=>{let{limit:u,offset:r}=n,i=new URLSearchParams;void 0!==u&&i.append("limit",u.toString()),void 0!==r&&i.append("offset",r.toString());let a=i.toString();return a=a?"?".concat(a):"",(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/chat_conversations").concat(a))).json()},[null==e?void 0:e.uuid,t])},T=function(e){let{suppressError:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,a.t)(),u=null==n?void 0:n.uuid,r=(0,_.useRef)([]),o=(0,v.useQueryClient)(),l="/api/organizations/".concat(null!=u?u:"","/chat_conversations/").concat(e,"?tree=True&rendering_mode=messages&render_all_tools=true"),c=(0,i.WE)(l,{queryKey:[s.I8,{orgUUID:u},{uuid:e}],staleTime:3e5,enabled:!!u&&!!e,meta:{noToast:t}},t=>(o.invalidateQueries({queryKey:[s.Gj,{orgUUID:u,conversationUUID:e}]}),(0,m.fX)(t))),d=(0,_.useMemo)(()=>{if(!c.data)return r.current=[],r.current;let e=(0,m.kX)(c.data);if(e.length!==r.current.length||e.some((e,t)=>{var n;return e.uuid!==(null===(n=r.current[t])||void 0===n?void 0:n.uuid)}))return r.current=e,r.current;for(let t=0;t<e.length;t++)g()(e[t],r.current[t])||(r.current[t]=e[t]);return r.current},[c.data]);return{...c,currentPath:d}},w=(e,t)=>{let{mutate:n}=S(),u=(0,p.useRouter)(),r=t||(0,d.H)();return(0,_.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{model:void 0,controlsOpen:!1},i={uuid:r,name:"",model:t.model};t.projectUuid&&(i.project_uuid=t.projectUuid),n(i);let a="/chat/".concat(r).concat(t.controlsOpen?"?controls=1":"");u[e](a)},[n,u,e,r])},S=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,n=(0,v.useQueryClient)(),u=[s.tv,{orgUUID:t}],r=e=>[s.ph,{orgUUID:t},{uuid:e}],o=e=>[s.I8,{orgUUID:t},{uuid:e}];return(0,i.uC)("/api/organizations/".concat(null!=t?t:"","/chat_conversations"),"POST",{enabled:!!t,async onMutate(e){let t=r(e.uuid),i={summary:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),...e};await Promise.all([n.cancelQueries({queryKey:u}),n.cancelQueries({queryKey:t})]),n.setQueryData(u,e=>e&&[i,...e]),n.setQueryData(t,e=>({...e||{},...i,chat_messages:(null==e?void 0:e.chat_messages)||[]}))},onSuccess:e=>{n.setQueryData(u,t=>{if(!t)return;let n=t.findIndex(t=>t.uuid===e.uuid);if(-1===n)return t;let u=[...t];return u.splice(n,1,e),u}),n.setQueryData(o(e.uuid),t=>({...t||{},...e,chat_messages:(null==t?void 0:t.chat_messages)||[],messageByUuid:new Map,parentByChildUuid:new Map,childrenByParentUuid:new Map,selectedChildByUuid:new Map})),$(n,t)},onError(e,t){n.setQueryData(u,e=>null==e?void 0:e.filter(e=>e.uuid!==t.uuid)),n.setQueryData(r(t.uuid),void 0)}})},K=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,n=(0,v.useQueryClient)();return(0,i.Ne)(e=>{let{uuid:n}=e;return"/api/organizations/".concat(null!=t?t:"","/chat_conversations/").concat(n)},"DELETE",(e,t)=>{let{uuid:n}=e;if(!t)return[];let u=t.findIndex(e=>e.uuid===n);if(!(u>-1))return t;{let e=[...t];return e.splice(u,1),e}},{enabled:!!t,queryKey:[s.tv,{orgUUID:t}],onSuccess:async(e,u)=>{let{uuid:r,projectUuid:i}=u;await n.invalidateQueries({queryKey:[s.I8,{orgUUID:t},{uuid:r}]}),i&&await n.invalidateQueries({queryKey:[s.lx,{orgUuid:t,projectUuid:i}]}),await $(n,t)}})},q=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,u=(0,v.useQueryClient)();return(0,i.uC)("/api/organizations/".concat(n,"/chat_conversations/delete_many"),"POST",{onSuccess:async t=>{await $(u,n),e&&e(t)}})},b=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,n=null==e?void 0:e.capabilities.includes("raven");return(0,i.WE)("/api/organizations/".concat(t,"/shares"),{queryKey:[s.PB,{orgUUID:t}],enabled:!!t&&n,staleTime:3e5})},P=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid;return(0,i.WE)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/latest"),{enabled:!!n&&!!e,queryKey:[s.Gj,{orgUUID:n,conversationUUID:e}],staleTime:0,meta:{noToast:!0}},e=>{let{snapshot:t,shareable:n,disabled_reason:u}=e;return{shareable:n,disabled_reason:u,snapshot:t?{...t,chat_messages:t.chat_messages.map(e=>(0,m.Dk)(e))}:null}})},j=e=>{let{activeOrganization:t,account:n}=(0,a.t)(),u=null==t?void 0:t.uuid,r=n&&u?"/api/organizations/".concat(u,"/chat_snapshots/").concat(e,"?rendering_mode=messages&render_all_tools=true"):"/api/chat_snapshots/".concat(e,"?rendering_mode=messages&render_all_tools=true");return(0,i.WE)(r,{retry:!1,refetchInterval:!1,enabled:!!e,staleTime:0,queryKey:[s.ld,{orgUUID:u,snapshotUUID:e}]},e=>({...e,chat_messages:e.chat_messages.map(e=>(0,m.Dk)(e))}))},z=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid,u=(0,v.useQueryClient)();return(0,i.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/share"),"POST",{onSuccess:()=>{u.invalidateQueries({queryKey:[s.Gj,{orgUUID:n,conversationUUID:e}]}),u.invalidateQueries({queryKey:[s.PB,{orgUUID:n}]}),u.invalidateQueries({queryKey:[s.VH,{orgUUID:n}]})}})},B=(e,t)=>{let{activeOrganization:n}=(0,a.t)(),u=null==n?void 0:n.uuid,r=(0,v.useQueryClient)();return(0,i.uC)("/api/organizations/".concat(u,"/share/").concat(t),"DELETE",{enabled:!!u&&!!t,meta:{errorMessage:"There was an error while trying to unshare the conversation. Please try again."},onSuccess:()=>{r.invalidateQueries({queryKey:[s.Gj,{orgUUID:u,conversationUUID:e}]}),r.invalidateQueries({queryKey:[s.PB,{orgUUID:u}]}),r.invalidateQueries({queryKey:[s.VH,{orgUUID:u}]})}})},D=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid;return(0,i.WE)("/api/organizations/".concat(n,"/artifact-versions/").concat(e),{retry:!1,refetchInterval:!1,enabled:!!e,staleTime:0,queryKey:[s.qB,{artifactVersionUUID:e}]})},E=function(e,t,n){var u,l,c;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{track:f}=(0,r.z$)(),y=null!==(l=null===(u=(0,o.T)())||void 0===u?void 0:u.preview_feature_uses_artifacts)&&void 0!==l&&l,{activeOrganization:g}=(0,a.t)(),p=null==g?void 0:g.uuid,_=(0,v.useQueryClient)(),m=[s.I8,{orgUUID:p},{uuid:e}];return(0,i.uC)("/api/organizations/".concat(null!=p?p:"","/chat_conversations/").concat(e,"/chat_messages/").concat(null!==(c=t.uuid)&&void 0!==c?c:"","/chat_feedback"),t.chat_feedback?"PUT":"POST",{enabled:!!p,meta:{errorMessage:"We could not save your feedback. Please try again later."},...d,onSuccess(){for(var u,r,i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];f({event_key:"claudeai.conversation.feedback.sent",message_uuid:t.uuid,conversation_uuid:e,artifacts_enabled:y,conversationHasArtifacts:n,type:null===(u=t.chat_feedback)||void 0===u?void 0:u.type}),_.invalidateQueries({queryKey:m}),null===(r=d.onSuccess)||void 0===r||r.call(d,...a)}})},x=()=>{let e=(0,v.useQueryClient)(),{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid;return(0,_.useCallback)((t,u)=>{t&&(e.setQueryData([s.I8,{orgUUID:n},{uuid:t}],e=>e&&{...e,...u}),e.setQueriesData({queryKey:[s.tv,{orgUUID:n}]},e=>null==e?void 0:e.map(e=>e.uuid!==t?e:{...e,...u})))},[n,e])},k=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,a.t)(),u=null==n?void 0:n.uuid,r=x();return(0,i.uC)("/api/organizations/".concat(u,"/chat_conversations/").concat(e),"PUT",{onMutate:n=>{var i;let{name:a}=n,o=t.getQueryData([s.I8,{orgUUID:u},{uuid:e}]);return r(e,{name:a}),{oldTitle:null!==(i=null==o?void 0:o.name)&&void 0!==i?i:""}},onError(t,n,u){u&&r(e,{name:u.oldTitle})}})},O=e=>{let t=x(),{activeOrganization:n}=(0,a.t)();return(0,i.uC)("/api/organizations/".concat(null==n?void 0:n.uuid,"/chat_conversations/").concat(e,"/title"),"POST",{onSuccess(n){let{title:u}=n;t(e,{name:null!=u?u:""})},meta:{noToast:!0}})};function I(e){var t,n;let u=(0,l.K)(e);return u+" "+e.attachments.map(e=>e.extracted_content).join(" ")+" "+((null===(t=e.content)||void 0===t?void 0:t.filter(e=>"tool_use"===e.type).map(e=>e.input?JSON.stringify(e.input):e.partial_json||"").join(" "))||"")+" "+((null===(n=e.content)||void 0===n?void 0:n.filter(e=>"tool_result"===e.type).flatMap(e=>e.content.filter(e=>"text"===e.type).map(e=>e.text)).join(" "))||"")}let M=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid;return(0,i.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/stop_response"),"POST")},L=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid;return(0,i.uC)(e=>{let{conversation_uuid:n}=e;return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/tool_result")},"POST",{enabled:!!t,meta:{errorMessage:"We could not record the tool result. Please try again later."},transformVariables:e=>{let{conversation_uuid:t,...n}=e;return n}})},R=e=>{let{activeOrganization:t}=(0,a.t)(),n=null==t?void 0:t.uuid;return(0,i.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/current_leaf_message_uuid"),"PUT")},W=e=>{let{activeOrganization:t}=(0,a.t)(),n=(0,v.useQueryClient)(),u=null==t?void 0:t.uuid;return(0,i.Ne)("/api/organizations/".concat(u,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,settings:{...t.settings,...e.settings}}:void 0,{enabled:!!e,onSuccess:()=>{$(n,u)},queryKey:[s.I8,{orgUUID:u},{uuid:e}]})},N=e=>{let{account:t}=(0,a.t)(),{mutate:n}=(0,u.Ck)(),{mutate:r}=W(e);return{toggleConvoAndAccountSetting:u=>{if(!t)return;let i={};for(let[e,t]of Object.entries(u))void 0!==u[e]&&(i[e]=t);e&&r({settings:i}),n({...t.settings,...i})}}},$=async(e,t)=>{await e.invalidateQueries({queryKey:[s.tv,{orgUUID:t}]})},G=e=>{let{activeOrganization:t}=(0,a.t)(),n=(0,v.useQueryClient)(),u=null==t?void 0:t.uuid;return(0,i.Ne)("/api/organizations/".concat(u,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{$(n,u)},queryKey:[s.I8,{orgUUID:u},{uuid:e}]})},H=()=>{let{data:e,isLoading:t}=Q({limit:void 0});return{data:null==e?void 0:e.filter(e=>e.is_starred),isLoading:t}}},1146:function(e,t,n){n.d(t,{Dk:function(){return v},Ef:function(){return s},FC:function(){return a},Gg:function(){return c},HX:function(){return g},QC:function(){return l},fX:function(){return y},kX:function(){return _},mj:function(){return m},vv:function(){return p},w$:function(){return d},wZ:function(){return o}});var u=n(45144),r=n(52221),i=n.n(r);let a="new-assistant-message-uuid",o="new-human-message-uuid",l="00000000-0000-4000-8000-000000000000",s=e=>e!==a;function c(e,t){let n=e.get(t);if(void 0===n){let e=Error("Key not found: ".concat(t));throw(0,u.Tb)(e),e}return n}let d=(e,t)=>{let n=null!=t?t:e.current_leaf_message_uuid;if(!n)return e;for(;n!==l;){var u;let t=c(e.parentByChildUuid,n),r=null===(u=c(e.childrenByParentUuid,t))||void 0===u?void 0:u.indexOf(n);e.selectedChildByUuid.set(t,r),n=t}return{...e,current_leaf_message_uuid:t}},v=e=>e.content?e:{...e,content:[{type:"text",text:e.text||"",citations:[]}]},f=e=>{var t,n,u;let r=new Map,i=new Map,a=new Map,o=new Map,s=new Map;if(0===e.chat_messages.length)return{messageByUuid:i,parentByChildUuid:a,childrenByParentUuid:o,selectedChildByUuid:s};let c=e.chat_messages.map(v);for(let e of c)r.set(e.index,e),i.set(e.uuid,e);for(let e of c){let t=e.parent_message_uuid;if(!t){let u=e.index-1;for(;!t&&u>=0;)t=null===(n=r.get(u))||void 0===n?void 0:n.uuid,u--}t=null!=t?t:l,a.set(e.uuid,t),o.set(t,(null!==(u=o.get(t))&&void 0!==u?u:[]).concat(e.uuid)),s.set(t,0)}if(!(null===(t=o.get(l))||void 0===t?void 0:t[0]))throw Error("No root message found");return{chat_messages:c,messageByUuid:i,parentByChildUuid:a,childrenByParentUuid:o,selectedChildByUuid:s}},y=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Set;for(let t of e.chat_messages)"assistant"===t.sender&&t.parent_message_uuid&&n.add(t.parent_message_uuid);let u=e.chat_messages.filter(e=>"assistant"===e.sender||n.has(e.uuid)||void 0===e.parent_message_uuid||t),r={...e,chat_messages:u},i={...r,...f(r)};return i.current_leaf_message_uuid||d(i),d(i,r.current_leaf_message_uuid)},g=e=>{let t=Array.from(e.messageByUuid.values()).map(e=>e.index);return 0===t.length?-1:Math.max(...t)},p=(e,t)=>{for(let u of(e.chat_messages=e.chat_messages.concat(t),t)){var n;if(!u.parent_message_uuid)throw Error("Parent UUID required");let t=u.parent_message_uuid;e.messageByUuid.set(u.uuid,u),e.parentByChildUuid.set(u.uuid,t);let r=null!==(n=e.childrenByParentUuid.get(t))&&void 0!==n?n:[];r.push(u.uuid),e.childrenByParentUuid.set(t,r),e.selectedChildByUuid.set(t,r.length-1)}return d(e,t[t.length-1].uuid)},_=(e,t)=>{let n=[],u=null!=t?t:l;for(;e.childrenByParentUuid.has(u);){let t=c(e.childrenByParentUuid,u);if(0===t.length)break;let r=c(e.selectedChildByUuid,u),i=c(e.messageByUuid,t[r]);n.push({...i,parent_message_uuid:u,nOptions:t.length,selectedOption:r}),u=i.uuid}return n};function m(e,t,n){var u;let r=c(e.parentByChildUuid,t.uuid),a=c(e.childrenByParentUuid,r),o=i()((null!==(u=t.selectedOption)&&void 0!==u?u:0)+n,0,a.length-1);e.selectedChildByUuid.set(r,o);let l=_(e,r);return d(e,l[l.length-1].uuid)}},1812:function(e,t,n){n.d(t,{I:function(){return o},T:function(){return a}});var u=n(27573),r=n(7653);let i=(0,r.createContext)(null),a=()=>{let e=(0,r.useContext)(i);return void 0===e?null:e},o=e=>{let{children:t,settings:n}=e;return(0,u.jsx)(i.Provider,{value:n,children:t})}},98731:function(e,t,n){n.d(t,{K:function(){return u}});let u=e=>{let t="";if(e.content)for(let n of e.content)"text"===n.type&&(t+=n.text);return t}},25551:function(e,t,n){n.d(t,{B:function(){return r}});var u=n(7653);function r(e){let t=JSON.stringify(e);return(0,u.useMemo)(()=>e,[t])}},51432:function(e,t,n){n.d(t,{H:function(){return u}});let u=()=>void 0===crypto.randomUUID?"".concat(1e7,"-",1e3,"-",4e3,"-",8e3,"-",1e11).replace(/[018]/g,e=>{let t=parseInt(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}):crypto.randomUUID()}}]);